{% extends 'inventario/index.html'%}
{% block contenido %}
{% load static %}
<div class="row mt-3">
    <div class="col d-flex align-items-center justify-content-center">
        <div class="row d-flex justify-content-center">
            <h3 class="text-center">Salida</h3>
        </div>
    </div>
</div>
<hr>

<div class="row justify-content-center mx-2">
    <div class="col">
        <div class="form-floating">
            <select name="cliente" id="cliente" class="form-select">
                <option value="">Selecciona un cliente</option>
                {% for cliente in clientes %}
                <option value="{{ cliente.id }}">{{ cliente.nombre }}</option>
                {% endfor %}
            </select>
            <label for="cliente" class="form-label">Cliente:</label>
        </div>
        <div class="d-flex justify-content-center mt-2 mb-2">
            <a class="btn buttons fw-bold" href="{% url 'clientes' %}"><i class="fa-solid fa-circle-plus"></i>
                Agregar Clientes
            </a>
        </div>
    </div>
    <div class="col">
        <div class="form-floating">
            <select name="producto_name" id="producto_name" class="form-select">
                <option value="">Selecciona un producto</option>
                {% for producto in productos %}
                <option value="{{ producto.id }}">{{ producto.nombre }}</option>
                {% endfor %}
            </select>
            <label for="producto_name" class="form-label">Producto:</label>
        </div>
        <div class="d-flex justify-content-center mt-2 mb-2">
            <a class="btn buttons fw-bold" href="{% url 'productos' %}"><i class="fa-solid fa-circle-plus"></i>
                Agregar Productos
            </a>
        </div>
    </div>
</div>

<div class="row mx-2">
    
    <div class="col">
        <div id="cantidad-div">
            <div class="form-floating">
                <input type="text" id="cantidad" name="cantidad" placeholder="Cantidad" class="form-control">
                <label for="cantidad" class="form-label">Cantidad:</label>
            </div>
        </div>
    </div>
    <div class="col">
        <div id="precio-div">
            <div class="form-floating">
                <input type="text" id="precio" name="precio" placeholder="Precio" class="form-control" readonly>
                <label for="precio" class="form-label">Precio: </label>
            </div>
        </div>
    </div>
    
</div>
<hr />
<div class="row mx-2">
    <div class="col">
        <table class="table">
            <thead>
                <tr>
                    <th>Producto</th>
                    <th>Cantidad</th>
                    <th>Precio Unitario</th>
                    <th>Precio Total</th>
                </tr>
            </thead>
            <tbody id="tabla-venta">
            </tbody>
        </table>
    </div>
</div>

<div class="row mx-2">
    <div class="col d-flex justify-content-center mt-3">
        <button id="realizar-venta" type="button" class="btn buttons mx-1 mt-3 fw-bold">Realizar Venta</button>
    </div>
</div>
<hr>

<script>
      // Variable para almacenar los detalles de la venta
      var detallesVenta = [];

      // Evento al hacer clic en "Agregar Producto"
      $('#agregar-producto').click(function () {
          var productoId = $('#producto_name').val();
          var productoNombre = $('#producto_name option:selected').text();
          var cantidad = parseInt($('#cantidad').val(), 10);
          var precioUnitario = parseFloat($('#producto_name option:selected').data('precio'));
  
          if (!isNaN(cantidad) && cantidad > 0 && !isNaN(precioUnitario)) {
              agregarProducto(productoId, productoNombre, cantidad, precioUnitario);
          }
      });
  
      // Evento al hacer clic en "Realizar Venta"
      $('#realizar-venta').click(function () {
          var cliente = $('#cliente').val();
          if (cliente && detallesVenta.length > 0) {
              var data = {
                  cliente: cliente,
                  detalles: detallesVenta
              };
  
              axios.defaults.xsrfCookieName = 'csrftoken';
              axios.defaults.xsrfHeaderName = 'X-CSRFToken';
  
              axios.post("/api/crear-venta/", data, {
                  headers: {
                      "Content-Type": "application/json",
                  }
              })
                  .then(response => {
                      // Manejar la respuesta de la API
                      console.log(response.data);
                      if (response.status === 201) {
                          // La venta se realizó con éxito, puedes realizar acciones adicionales aquí
                      }
                  })
                  .catch(error => {
                      console.error(error);
                      // Manejar errores, como validación de la API, aquí
                  });
          }
      });
</script>


{% endblock %}
